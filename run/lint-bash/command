#!/usr/bin/env bash
set -e

GREEN="\e[32m"
RED="\e[31m"
RESET="\e[0m"

rootDir="$1"
shift

readarray -t bash_files < <(mrt --team-dir "$rootDir" run find-bash-files)

function check_linting {
	local file="$1"
	echo -e "Linting file: $file"
	if shellcheck "$file"; then
		echo -e "${GREEN}✓ No linting issues in $file${RESET}"
	else
		echo -e "${RED}✗ Linting issues found in $file${RESET}"
	fi
	echo
}

for file in "${bash_files[@]}"; do
	if [[ -f "$file" && -s "$file" && -r "$file" ]]; then
		check_linting "$file"
	else
		echo -e "${RED}Skipping invalid file: $file${RESET}"
		echo
	fi
done

echo -e "All files processed."
